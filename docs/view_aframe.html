<!doctype HTML>
<html>
<title>AFrame - LinkParam</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/0.7.1/aframe.min.js"></script>
<script src="js/handlebars.js"></script>
<script src="js/linkparam.js"></script>
<script src="js/viewar.js"></script>
<!-- Load the handlebars-template form DB file - templates stored in JSON format loaded into vDataJSON -->
<script>
  var vDataJSON = {};
</script>
<script src="db/handlebars_tpl.js"></script>
<!-- the following default data is loaded into JSON id "initdata" in vDataJSON -->
<script src="db/data.js"></script>
<script>
//-------------------------------------------------------
// LINK PARAMETER: Evaluation link parameter in JSON Path
var vLinkParam = new LinkParam();
vLinkParam.init(document);
//----MARKER load ------
var vID = "marker";
if (vLinkParam.exists(vID)) {
  console.log("Parameter '"+vID+"' exists");
  //--- Overwrite the default value in marker, jsondata ---
  var vMarker = vLinkParam.getValue(vID);
  // a Marker may consist of characters only - remove all other chars for security
  vMarker = vMarker.replace(/[^A-Za-z]/g,"");
  vDataJSON[vID] = vMarker;
};
//----JSONDATA load into "initdata"------
vID = "jsondata";
if (vLinkParam.exists(vID)) {
    console.log("Parameter '"+vID+"' exists");
    //--- Overwrite the default value in marker, jsondata ---
    vDataJSON["jsondata"] = parseJSON3D(vLinkParam.getValue(vID));
  } else {
    console.log("Use initdata of 3D objects for '"+vID+"'");
    vDataJSON["jsondata"] = vDataJSON["initdata"];
  };
}
//-------------------------------------------------------
</script>
<body id="htmlbody" style='margin : 0px; overflow: hidden;'>
    <!--
    <a-scene>
  	<a-marker id="mymarker" preset="hiro">
      <a-box position='0 0.5 0' material='color: blue;opacity:0.5'></a-box>
  	</a-marker>
  	<a-entity camera></a-entity>
    </a-scene>
    -->
  </body>
  <script>
  //-------------------------------------------------------
  // INJECT TEMPLATE: HandleBar generated HTML
  //-------------------------------------------------------
  function el(pID) {
    // this is a function that shortens the the getElementById call
    return document.getElementById(pID);
  };
  //----- Parse the JSON data of the AR objects -----------
  // use template vDataJSON["aframetpl"] defined db/handlebars_tpl.js
  el("htmlbody").innerHTML = compileHTML("aframetpl",vDataJSON["jsondata"],vDataJSON["marker"]);
  </script>
</html>
